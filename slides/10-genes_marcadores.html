<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Identificaci√≥n de marcadores</title>
    <meta charset="utf-8" />
    <meta name="author" content="Yalbi I. Balderas-Mart√≠nez" />
    <meta name="date" content="2021-08-09" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <script src="libs/kePrint/kePrint.js"></script>
    <link href="libs/lightable/lightable.css" rel="stylesheet" />
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# <strong>Identificaci√≥n de marcadores</strong>
## <strong>Bioconductor</strong> para datos transcript√≥micos de c√©lula √∫nica (<strong>scRNA-seq</strong>) ‚Äì <strong>CDSB2021</strong>
### Yalbi I. Balderas-Mart√≠nez
### 2021-08-09

---






class: inverse

.center[

&lt;a href="https://osca.bioconductor.org/"&gt;&lt;img src="https://raw.githubusercontent.com/Bioconductor/OrchestratingSingleCellAnalysis-release/master/images/cover.png" style="width: 30%"/&gt;&lt;/a&gt;

&lt;a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"&gt;&lt;img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /&gt;&lt;/a&gt;&lt;br /&gt;This work is licensed under a &lt;a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"&gt;Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License&lt;/a&gt;.


]

.footnote[Descarga los materiales con `usethis::use_course('comunidadbioinfo/cdsb2021')` o rev√≠salos en l√≠nea via [**comunidadbioinfo.github.io/cdsb2021**](http://comunidadbioinfo.github.io/cdsb2021).]

&lt;style type="text/css"&gt;
/* From https://github.com/yihui/xaringan/issues/147  */
.scroll-output {
  height: 80%;
  overflow-y: scroll;
}
/* https://stackoverflow.com/questions/50919104/horizontally-scrollable-output-on-xaringan-slides */
pre {
  max-width: 100%;
  overflow-x: scroll;
}
/* From https://github.com/yihui/xaringan/wiki/Font-Size */
.tiny{
  font-size: 40%
}
/* From https://github.com/yihui/xaringan/wiki/Title-slide */
.title-slide {
  background-image: url(https://raw.githubusercontent.com/Bioconductor/OrchestratingSingleCellAnalysis/master/images/Workflow.png);
  background-size: 33%;
  background-position: 0% 100%
}
&lt;/style&gt;

---

# Diapositivas de Peter Hickey

Ver las diapositivas originales [aqu√≠](https://docs.google.com/presentation/d/18NArqbfeo3Ujo8bcSJTWXirY8N4lEG-T_tFEqlI-uek/edit)

Plantilla desarrollada por: [Leonardo Collado-Torres](http://lcolladotor.github.io/)

---

# Motivaci√≥n 

Ahora que hemos obtenido los cl√∫steres, nos preguntamos, pero qu√© son? (e.g. ¬øqu√© tipo celular es el cl√∫ster 1?)

¬øCu√°les genes est√°n dirigiendo el agrupamiento (e.g., ¬øcu√°les son los genes diferencialmente expresados entre los cl√∫steres 1 y 2?)

Idea: Mirar las diferencias en los perfiles de expresi√≥n de las c√©lulas de los diferentes cl√∫steres

---

class: inverse center middle

# Dataset ilustrativo: PBMC4k 10X sin filtrar

---

# Dataset ilustrativo: PBMC4k 10X sin filtrar


```r
library(BiocFileCache)
bfc &lt;- BiocFileCache()
raw.path &lt;- bfcrpath(bfc, file.path(
    "http://cf.10xgenomics.com/samples",
    "cell-exp/2.1.0/pbmc4k/pbmc4k_raw_gene_bc_matrices.tar.gz"
))
untar(raw.path, exdir = file.path(tempdir(), "pbmc4k"))
```

---

# Dataset ilustrativo: PBMC4k 10X sin filtrar


```r
library(DropletUtils)
library(Matrix)
fname &lt;- file.path(tempdir(), "pbmc4k/raw_gene_bc_matrices/GRCh38")
sce.pbmc &lt;- read10xCounts(fname, col.names = TRUE)
```

Dataset "C√©lulas mononucleares humanas de sangre perif√©rica" de 10X Genomics

Descripci√≥n [aqu√≠](https://osca.bioconductor.org/unfiltered-human-pbmcs-10x-genomics.html)

.footnote[Zheng, G. X. Y. et al. Massively parallel digital transcriptional profiling of single cells. Nat. Commun. 8, 14049 (2017)]

---

# Dataset ilustrativo: PBMC4k 10X sin filtrar


```r
# gene-annotation
library(scater)
rownames(sce.pbmc) &lt;- uniquifyFeatureNames(
    rowData(sce.pbmc)$ID, rowData(sce.pbmc)$Symbol
)
library(EnsDb.Hsapiens.v86)
location &lt;- mapIds(EnsDb.Hsapiens.v86,
    keys = rowData(sce.pbmc)$ID,
    column = "SEQNAME", keytype = "GENEID"
)
# cell-detection
set.seed(100)
e.out &lt;- emptyDrops(counts(sce.pbmc))
sce.pbmc &lt;- sce.pbmc[, which(e.out$FDR &lt;= 0.001)]
```

.footnote[Zheng, G. X. Y. et al. Massively parallel digital transcriptional profiling of single cells. Nat. Commun. 8, 14049 (2017)]

---

# Dataset ilustrativo: PBMC4k 10X sin filtrar


```r
# quality-control
stats &lt;- perCellQCMetrics(sce.pbmc, 
  subsets=list(Mito=which(location=="MT")))
high.mito &lt;- isOutlier(stats$subsets_Mito_percent, 
                       type="higher")
sce.pbmc &lt;- sce.pbmc[,!high.mito]

# normalization
library(scran)
set.seed(1000)
clusters &lt;- quickCluster(sce.pbmc)
sce.pbmc &lt;- computeSumFactors(sce.pbmc, cluster=clusters)
sce.pbmc &lt;- logNormCounts(sce.pbmc)
```

.footnote[Zheng, G. X. Y. et al. Massively parallel digital transcriptional profiling of single cells. Nat. Commun. 8, 14049 (2017)]

---

# Dataset ilustrativo: PBMC4k 10X sin filtrar


```r
# variance modelling
set.seed(1001)
dec.pbmc &lt;- modelGeneVarByPoisson(sce.pbmc)
top.pbmc &lt;- getTopHVGs(dec.pbmc, prop = 0.1)
```

.footnote[Zheng, G. X. Y. et al. Massively parallel digital transcriptional profiling of single cells. Nat. Commun. 8, 14049 (2017)]

---

# Dataset ilustrativo: PBMC4k 10X sin filtrar


```r
# dimensionality-reduction
set.seed(10000)
sce.pbmc &lt;- denoisePCA(sce.pbmc, subset.row=top.pbmc, 
  technical=dec.pbmc)

set.seed(100000)
sce.pbmc &lt;- runTSNE(sce.pbmc, dimred="PCA")

set.seed(1000000)
sce.pbmc &lt;- runUMAP(sce.pbmc, dimred="PCA")
```

.footnote[Zheng, G. X. Y. et al. Massively parallel digital transcriptional profiling of single cells. Nat. Commun. 8, 14049 (2017)]

---

# Dataset ilustrativo: PBMC4k 10X sin filtrar


```r
# clustering
g &lt;- buildSNNGraph(sce.pbmc, k=10, use.dimred="PCA")
clust &lt;- igraph::cluster_walktrap(g)$membership
sce.pbmc$cluster &lt;- factor(clust)
```

.footnote[Zheng, G. X. Y. et al. Massively parallel digital transcriptional profiling of single cells. Nat. Commun. 8, 14049 (2017)]

---

class: inverse center middle

# Motivaci√≥n - continuaci√≥n

---

# Motivaci√≥n


```r
# Is gene 1 associated with the clustering?
plotExpression(sce.pbmc, features=rownames(sce.pbmc)[1],
  x="cluster", colour_by="cluster")
```

---

# Motivaci√≥n

![](11-genes_marcadores_files/figure-html/unnamed-chunk-10-1.png)&lt;!-- --&gt;

---

# Motivaci√≥n


```r
# Is gene 2 associated with the clustering?
plotExpression(sce.pbmc, features=rownames(sce.pbmc)[2],
  x="cluster", colour_by="cluster")
```

---

# Motivaci√≥n

![](11-genes_marcadores_files/figure-html/unnamed-chunk-12-1.png)&lt;!-- --&gt;

---

# Motivaci√≥n


```r
# Is gene 2512 associated with the clustering?
plotExpression(sce.pbmc, features=rownames(sce.pbmc)[2512],
  x="cluster", colour_by="cluster")
```

---

# Motivaci√≥n

![](11-genes_marcadores_files/figure-html/unnamed-chunk-14-1.png)&lt;!-- --&gt;

---

# Motivaci√≥n


```r
# Is gene 2512 associated with the clustering?
plotExpression(sce.pbmc, features="CD3E",
  x="cluster", colour_by="cluster")
```

---

# Motivaci√≥n

![](11-genes_marcadores_files/figure-html/unnamed-chunk-16-1.png)&lt;!-- --&gt;

---

# Motivaci√≥n

Ver una gr√°fica como una forma de encontrar los genes marcadores obviamente no nos sirve a gran escala

Necesitamos un m√©todo estad√≠stico para identificar estos genes marcadores 

* üëâ La prueba t de Welch es una opci√≥n obvia para probar las diferencias en la expresi√≥n entre cl√∫steres

---

# Prueba t modificada de Welch pareada

* ‚ûï R√°pidas y buenas propiedades estad√≠sticas para un gran n√∫mero de c√©lulas [(Soneson and Robinson, 2018)](https://www.ncbi.nlm.nih.gov/pubmed/29481549)

* ‚ûï Las comparaciones pareadas proveen un _log-fold change_ para indicar cu√°les cl√∫sterse son distinguidos por cada gen 

* ü§î ¬øPor qu√© no comparar cada cl√∫ster con el promedio de todas las otras c√©lulas?
  - Sensible a la composici√≥n poblacional, una subpoblaci√≥n dominante sola que dirige la selecci√≥n de los marcadores _top_ para cualquier otro cl√∫ster 

---

class: inverse center middle

# Ejemplo ilustrativo: CD3E como gen marcador en el dataset PBMC4k 10X

---

# Pruebas pareadas

![](11-genes_marcadores_files/figure-html/unnamed-chunk-17-1.png)&lt;!-- --&gt;

---

# Pruebas pareadas

&lt;table class="table table-striped table-hover" style="font-size: 12px; width: auto !important; "&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; comparison &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; logFC &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Pval &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 1 vs 2 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.50 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.7e-198 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 1 vs 3 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; -0.08 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.11 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; ... &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; ... &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; ... &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 2 vs 1 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.39 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.7e-198 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; ... &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; ... &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; ... &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 18 vs 17 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.11 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.46 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

K = 18 cl√∫steres
K!/K-2)! = 306 comparaciones
* La mitad de ellas son **redundantes**

---

# Combinando comparaciones del gen CD3E para el cl√∫ster 1

"Me interesa saber si el gen CD3 est√° diferencialmente expresado entre el cl√∫ster 1 y .."

- **cualquier** (**any**) otro cl√∫ster = P = 1.3 x 10&lt;sup&gt;-205&lt;/sup&gt; (Simes adjusted P-value)
- **todos** (**all**) los otros cl√∫steres = P = 0.11 (Berger's intersection-union test)
- **algunos** (**some**) de los otros cl√∫steres = P = 2.0 x 10&lt;sup&gt;-44&lt;/sup&gt; (mediana u otro cuantil, Holm-adjusted P-values)

---

# Extendiendo a todos los genes


```r
# scran::pairwiseTTests()
# scran::combineMarkers()
```

- M = 33,694 genes
- ü§ì K x M = 10,310,364 pruebas
- Comparaciones involucrando cl√∫ster 1...
- Comparaciones involucrando cl√∫ster ...
- Comparaciones involucrando cl√∫ster 18

---

class: inverse center middle

# Aplicaci√≥n est√°ndar

---

# Aplicaci√≥n est√°ndar

Para cada cl√∫ster, usar pruebas **t de Welch** para identificar los genes que est√°n diferencialmente expresados entre √©ste y **cualquier** (**any**) otro cl√∫ster 


```r
# scran::findMarkers()
library(scran)
markers.pbmc &lt;- findMarkers(sce.pbmc, groups=sce.pbmc$cluster,
  test.type="t", pval.type="any")
```

---

# Aplicaci√≥n est√°ndar


```r
chosen &lt;- "9"
interesting &lt;- markers.pbmc[[chosen]]
```

---

# Aplicaci√≥n est√°ndar


```r
plotExpression(sce.pbmc, rownames(interesting)[1:4],
  x="cluster", colour_by="cluster")
```

---

# Aplicaci√≥n est√°ndar

![](11-genes_marcadores_files/figure-html/unnamed-chunk-23-1.png)&lt;!-- --&gt;

---

# Aplicaci√≥n est√°ndar


```r
best.set &lt;- interesting[interesting$Top &lt;= 6,]
logFCs &lt;- as.matrix(best.set[,-(1:3)])
colnames(logFCs) &lt;- sub("logFC.", "", colnames(logFCs))

library(pheatmap)
pheatmap(logFCs, breaks=seq(-5, 5, length.out=101))
```

üëâ Usamos el campo _Top_ para identificar un conjunto de genes que distinguen el cl√∫ster 9 de cualquier otro cl√∫ster

---

# Aplicaci√≥n est√°ndar

![](11-genes_marcadores_files/figure-html/unnamed-chunk-25-1.png)&lt;!-- --&gt;

---

class: inverse center middle

# Usando el _log-fold change_

---

# Usando el _log-fold change_

Para cada cl√∫ster, usa pruebas t de Welch para identificar los genes que est√°n sobreexpresados entre √©ste y **cualquier** otro cl√∫ster


```r
markers.pbmc.up &lt;- findMarkers(sce.pbmc, groups=sce.pbmc$cluster,
  test.type="t", direction="up", pval.type="any")
interesting.up &lt;- markers.pbmc.up[[chosen]]
```

---

# Usando el _log-fold change_

Para cada cl√∫ster, usa pruebas t de Welch para identificar los genes que est√°n sobreexpresados con un log-fold change (lfc) o al menos 1 entre √©ste y **cualquier** otro cl√∫ster


```r
markers.pbmc.up2 &lt;- findMarkers(sce.pbmc, groups=sce.pbmc$cluster,
  test.type="t", direction="up", lfc=1, pval.type="any")
interesting.up2 &lt;- markers.pbmc.up2[[chosen]]
```

* üëâ La prueba t tambi√©n nos permite especificar un _log-fold change_ diferente de cero como la hip√≥tesis nula 
* ü§ì Es m√°s riguroso que simplemente filtrar por _log-fold change_ [TREAT](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2654802/)

---

# Usando el _log-fold change_


```r
best.set &lt;- interesting.up2[interesting.up2$Top &lt;= 5,]
logFCs &lt;- as.matrix(best.set[,-(1:3)])
colnames(logFCs) &lt;- sub("logFC.", "", colnames(logFCs))

pheatmap(logFCs, breaks=seq(-5, 5, length.out=101))
```

* üëâ Los promedios est√°n m√°s centrados en un conjunto de genes marcadores candidatos que est√°n sobreexpresados en el cl√∫ster 9 
* ‚ö†Ô∏è El incremento del rigor no se da sin costo 
* ‚ö†Ô∏è Si el _lfc_ es muy grande podr√≠a descartar genes √∫tiles
	- E.g., un gen sobreexpresado en una proporci√≥n peque√±a de c√©lulas en un cl√∫ster sigue siendo un marcador efectivo si el foco est√° en la especificidad m√°s que en la sensibilidad 
	
---

# Usando el _log-fold change_

![](11-genes_marcadores_files/figure-html/unnamed-chunk-29-1.png)&lt;!-- --&gt;

---

class: inverse center middle

# Encontrando marcadores espec√≠ficos de cl√∫steres

---

# Encontrando marcadores espec√≠ficos de cl√∫steres

* üëâ Por defecto, `scran::findMarkers()` dar√° un alto rango a genes que est√°n DE en cualquier comparaci√≥n pareada
* ü§î Quiero genes que son espec√≠ficos de cada cl√∫ster
* üëâ T√∫ quieres genes que son DE en todas las comparaciones pareadas

---

# Encontrando marcadores espec√≠ficos de cl√∫steres

Para cada cl√∫ster, usa pruebas t de Welch para identificar genes que est√°n sobreexpresados entre √©ste y **todos** los otros cl√∫steres 


```r
markers.pbmc.up3 &lt;- findMarkers(sce.pbmc, groups=sce.pbmc$cluster, 
  direction="up", pval.type="all")
interesting.up3 &lt;- markers.pbmc.up3[[chosen]]
```

ü§ì Usa una prueba de uni√≥n-intersecci√≥n para combinar los P-values que es el m√°ximo P-value de todas las comparaciones pareadas 

---

# Pros/cons de los genes marcadores espec√≠ficos de los cl√∫steres

&lt;table class="table table-striped table-hover" style="font-size: 12px; width: auto !important; "&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Poblacion &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Expresion_CD4 &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Expresion_CD8 &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; DN(CD4-/CD8-) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; No &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; No &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; CD4+&amp;gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Si &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; No &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; CD8+&amp;gt; &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; No &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Si &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; DP(CD4+/CD8+) &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Si &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; Si &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

# Encontrando los genes marcadores espec√≠ficos por cl√∫ster

Para cada cl√∫ster, usa pruebas t de Welch para identificar los genes que est√°n sobreexpresados entre √©ste y **algunos** de los otros cl√∫sters 


```r
markers.pbmc.up4 &lt;- findMarkers(sce.pbmc, groups=sce.pbmc$cluster,
  direction="up", pval.type="some")
interesting.up4 &lt;- markers.pbmc.up4[[chosen]]
```

* üëâ Para cuando `pval.type="all"` es muy estricto todav√≠a `pval.type="any"` es muy generoso
* ü§ì Aplica la correcci√≥n Holm-Bonferroni a los P-values y toma el mejor valor de en medio como el P-value combinado
* ‚ö†Ô∏è Perder√°s algunas garant√≠as ofrecidas por los otros m√©todos 

---

class: inverse center middle

# Pruebas alternas

---

# Motivaci√≥n

La prueba t no es la √∫nica forma de comparar dos grupos de mediciones

* ü§î Quiero una prueba que pueda ser usada perfectamente para distinguir dos cl√∫steres uno del otro
- üëâ Prueba de rangos Wilcoxon

* ü§î Quiero identificar genes que son expresados m√°s frecuentemente en un cl√∫ster que en otro
- üëâ Prueba Binomial

---

# Prueba de rangos de Wilcoxon

Eval√∫a directamente la separaci√≥n entre la distribuci√≥n de la expresi√≥n de los diferentes cl√∫steres

* ü§ì Es proporcional al √°rea bajo la curva (AUC), que es la probabilidad de que una c√©lula al azar de un cl√∫ster tenga mayor que expresi√≥n que una c√©lula al azar de otro cl√∫ster

* üëâ AUCs de 1 o 0 indican que los dos cl√∫steres tienen distribuciones de expresi√≥n separadas 

* ü§ì Tambi√©n se conoce como prueba Wilcoxon-Mann-Whitney (WMW)

---

# Prueba de rangos de Wilcoxon

Para cada cl√∫ster, usa la prueba de rangos de Wilcoxon para identificar genes que est√°n sobreexpresados entre √©ste y **cualquier** otro cl√∫ster 


```r
markers.pbmc.wmw &lt;- findMarkers(sce.pbmc,
  groups=sce.pbmc$cluster, test.type="wilcox",
  direction="up", pval.type="any")
interesting.wmw &lt;- markers.pbmc.wmw[[chosen]]
```

---

# Prueba de rangos de Wilcoxon


```r
best.set &lt;- interesting.wmw[interesting.wmw$Top &lt;= 5,]
AUCs &lt;- as.matrix(best.set[,-(1:3)])
colnames(AUCs) &lt;- sub("AUC.", "", colnames(AUCs))

pheatmap(AUCs, breaks=seq(0, 1, length.out=21), 
  color=viridis::viridis(21))
```

---

# Prueba de rangos de Wilcoxon

![](11-genes_marcadores_files/figure-html/unnamed-chunk-35-1.png)&lt;!-- --&gt;

---

# Resumen de la prueba de rangos de Wilcoxon

* ‚ûï Ofrece directamente la propiedad deseable de un gen marcador (i.e. que el gen distinga perfectamente entre dos cl√∫steres)
* ‚ûï Es sim√©trico con respecto a las diferencias en el tama√±o de los grupos comparados
* ‚ûñ Es mucho m√°s lento comparado con la prueba t (aunque esto en general no es un problema en la pr√°ctica)

---

# Prueba binomial

* Es una prueba que identifica los genes que difieren en la proporci√≥n de c√©lulas que se expresan entre cl√∫steres 
* Una definici√≥n mucho m√°s estricta de genes marcadores 

* ü§ì Convierte la expresi√≥n en una medida binaria de presencia/ausencia, por lo que toda la informaci√≥n cuantitativa es ignorada 
- Desde una perspectiva pr√°ctica, puede ser m√°s f√°cil para validar 

---

# Prueba binomial

Para cada cl√∫ster, usa la prueba Binomial para identificar genes que est√°n m√°s frecuentemente expresados (sobreexpresados) en comparaci√≥n con cualquier otro cl√∫ster 


```r
markers.pbmc.binom &lt;- findMarkers(sce.pbmc,
  groups=sce.pbmc$cluster, test.type="binom",
  direction="up", pval.type="any")
interesting.binom &lt;- markers.pbmc.binom[[chosen]]
```

* ü§ì El efecto en el tama√±o se reporta como el _log-fold change_ en la proporci√≥n de las c√©lulas que se expresan entre cl√∫steres 
* üëâ _Log-fold changes_ grandes positivos, indican que el gen est√° m√°s frecuentemente expresado en un cl√∫ster comparado con otro

---

# Prueba binomial


```r
top.genes &lt;- head(rownames(interesting.binom))
plotExpression(sce.pbmc, x="cluster", features=top.genes)
```

---

# Prueba binomial

![](11-genes_marcadores_files/figure-html/unnamed-chunk-38-1.png)&lt;!-- --&gt;

---

# Resumen de la prueba binomial

* La prueba Binomial no toma en cuenta la normalizaci√≥n

* ‚ûï Produce genes marcadores que pueden ser m√°s f√°ciles de validar

* ‚ûñ Ser m√°s estricto puede llevar a la p√©rdida de buenos marcadores candidatos  

---

# M√©todos de expresi√≥n diferencial personalizados

* ü§î ¬øPor qu√© no usar edgeR/DESeq2/limma-voom u otros m√©todos personalizados (e.g., MAST)?
* üëâ Claro que puedes! [Checa OSCA](https://osca.bioconductor.org/marker-detection.html#using-custom-de-methods)

* üëâ Pero √©stos son tal vez algo exagerados para identificar genes marcadores
* ü§ì Las c√©lulas son nuestras "r√©plicas" para el prop√≥sito de identificar genes marcadores
* ü§ì edgeR/DESeq2/limma-voom hacen asunciones m√°s fuertes acerca de los datos que es m√°s probable que no se cumplan para c√©lulas individuales en scRNA-seq

---

class: inverse center middle

# Problemas estad√≠sticos

---

# Invalidez de P-values

Todas las estrategias de DE para detectar genes marcadores entre cl√∫steres son estad√≠sticamente defectuosas de alguna manera

* ü§ì "Dragado de datos": El an√°lisis DE se realiza usando los mismos datos usados para obtener los cl√∫steres 

* üëâ Las pruebas para genes DE entre cl√∫steres producir√° inevitablemente algunos resultados significativos y as√≠ es como los cl√∫steres ser√°n definidos!

---

# Invalidez de P-values

üëâ A√∫n cuando los P-values son defectuosos, el efecto no es muy da√±ino para la detecci√≥n de genes ya que los P-values solo son usados para los rangos

ü§ì No se pueden usar P-values para definir "diferencias significativas" entre los cl√∫steres con respecto a un umbral de la tasa de error 

---

# Naturaleza de la replicaci√≥n

üëâ Idealmente, validar algunos de los marcadores con una poblaci√≥n de c√©lulas independientes (y idealmente usando una t√©cnica diferente, e.g., hibridaci√≥n fluorescente _in situ_ o qPCR)

---

class: inverse center middle

# Comentarios adicionales

---

# Comentarios adicionales

* üëâ La estrategia de an√°lisis DE es que los marcadores son definidos relativo a subpoblaciones en el mismo dataset 
* üëâ Si un gen se expresa uniformemente a trav√©s de la poblaci√≥n no servir√° como un marcador
- e.g., los marcadores de las c√©lulas T no ser√°n detectados si solamente hay c√©lulas T en los datos
- usualmente no es un problema, ya que tenemos idea de las c√©lulas que se capturaron
* üëâ Existen m√©todos de machine learning para hacer la identificaci√≥n de los genes marcadores, pero la humilde prueba t sigue siendo muy buena

---

class: inverse center middle

# Resumen y recomendaciones

---

# Resumen y recomendaciones

* üëâ Crea m√∫ltiples listas de genes marcadores con diferentes niveles de rigor
* üëâ La forma m√°s simple de interpretar los genes marcadores es que son los sobreexpresados de "forma √∫nica", o son "genes espec√≠ficos de cl√∫steres", especialmente si queremos imponer un _log-fold change_ m√≠nimo
* üëâ Puedes requerir hacer una identificaci√≥n de genes marcadores m√°s enfocada, e.g., subset de los datos de solo 2 cl√∫steres de inter√©s y entonces correr `scran::findMarkers()`

---

La presentaci√≥n fue hecha con el paquete de R [**xaringan**](https://github.com/yihui/xaringan) y configurada con [**xaringanthemer**](https://github.com/gadenbuie/xaringanthemer).

Este curso est√° basado en el libro [**Orchestrating Single Cell Analysis with Bioconductor**](https://osca.bioconductor.org/) de [Aaron Lun](https://www.linkedin.com/in/aaron-lun-869b5894/), [Robert Amezquita](https://robertamezquita.github.io/), [Stephanie Hicks](https://www.stephaniehicks.com/) y [Raphael Gottardo](http://rglab.org), adem√°s del [**curso de scRNA-seq para WEHI**](https://drive.google.com/drive/folders/1cn5d-Ey7-kkMiex8-74qxvxtCQT6o72h) creado por [Peter Hickey](https://www.peterhickey.org/).

Puedes encontrar los archivos para este taller en  [comunidadbioinfo/cdsb2021](https://github.com/comunidadbioinfo/cdsb2021). 

Instructora: [**Yalbi I. Balderas-Mart√≠nez**](http://Yalbibalderas.github.io/).

.footnote[Descarga los materiales con `usethis::use_course('comunidadbioinfo/cdsb2021')` o rev√≠salos en l√≠nea v√≠a [**comunidadbioinfo.github.io/cdsb2021**](http://comunidadbioinfo.github.io/cdsb2021).]

---

# Detalles de la sesi√≥n de R


.scroll-output[
.tiny[


```r
options(width = 120)
sessioninfo::session_info()
```

```
## ‚îÄ Session info ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
##  setting  value                       
##  version  R version 4.0.5 (2021-03-31)
##  os       Ubuntu 20.10                
##  system   x86_64, linux-gnu           
##  ui       X11                         
##  language (EN)                        
##  collate  en_US.UTF-8                 
##  ctype    en_US.UTF-8                 
##  tz       Etc/UTC                     
##  date     2021-08-09                  
## 
## ‚îÄ Packages ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
##  package              * version    date       lib source                               
##  AnnotationDbi        * 1.52.0     2020-10-27 [1] Bioconductor                         
##  AnnotationFilter     * 1.14.0     2020-10-27 [2] Bioconductor                         
##  askpass                1.1        2019-01-13 [3] CRAN (R 4.0.1)                       
##  assertthat             0.2.1      2019-03-21 [3] CRAN (R 4.0.1)                       
##  beachmat               2.6.4      2020-12-20 [2] Bioconductor                         
##  beeswarm               0.4.0      2021-06-01 [2] CRAN (R 4.0.5)                       
##  Biobase              * 2.50.0     2020-10-27 [1] Bioconductor                         
##  BiocFileCache        * 1.14.0     2020-10-27 [1] Bioconductor                         
##  BiocGenerics         * 0.36.0     2020-10-27 [1] Bioconductor                         
##  BiocNeighbors          1.8.2      2020-12-07 [2] Bioconductor                         
##  BiocParallel           1.24.1     2020-11-06 [1] Bioconductor                         
##  BiocSingular           1.6.0      2020-10-27 [2] Bioconductor                         
##  biomaRt                2.46.3     2021-02-09 [1] Bioconductor                         
##  Biostrings             2.58.0     2020-10-27 [1] Bioconductor                         
##  bit                    4.0.4      2020-08-04 [1] CRAN (R 4.0.5)                       
##  bit64                  4.0.5      2020-08-30 [1] CRAN (R 4.0.5)                       
##  bitops                 1.0-6      2013-08-17 [1] CRAN (R 4.0.5)                       
##  blob                   1.2.2      2021-07-23 [3] CRAN (R 4.0.5)                       
##  bluster                1.0.0      2020-10-27 [2] Bioconductor                         
##  bslib                  0.2.5.1    2021-05-18 [3] CRAN (R 4.0.5)                       
##  cachem                 1.0.4      2021-02-13 [1] CRAN (R 4.0.5)                       
##  cli                    3.0.1      2021-07-17 [3] CRAN (R 4.0.5)                       
##  colorspace             2.0-2      2021-06-24 [2] CRAN (R 4.0.5)                       
##  cowplot                1.1.1      2020-12-30 [1] CRAN (R 4.0.5)                       
##  crayon                 1.4.1      2021-02-08 [3] CRAN (R 4.0.5)                       
##  curl                   4.3.2      2021-06-23 [3] CRAN (R 4.0.5)                       
##  DBI                    1.1.1      2021-01-15 [3] CRAN (R 4.0.5)                       
##  dbplyr               * 2.1.1      2021-04-06 [3] CRAN (R 4.0.5)                       
##  DelayedArray           0.16.3     2021-03-24 [1] Bioconductor                         
##  DelayedMatrixStats     1.12.3     2021-02-03 [2] Bioconductor                         
##  digest                 0.6.27     2020-10-24 [3] CRAN (R 4.0.5)                       
##  dplyr                  1.0.7      2021-06-18 [2] CRAN (R 4.0.5)                       
##  dqrng                  0.3.0      2021-05-01 [2] CRAN (R 4.0.5)                       
##  DropletUtils         * 1.10.3     2021-02-02 [2] Bioconductor                         
##  edgeR                  3.32.1     2021-01-14 [2] Bioconductor                         
##  ellipsis               0.3.2      2021-04-29 [3] CRAN (R 4.0.5)                       
##  EnsDb.Hsapiens.v86   * 2.99.0     2021-08-08 [2] Bioconductor                         
##  ensembldb            * 2.14.1     2021-04-19 [2] Bioconductor                         
##  evaluate               0.14       2019-05-28 [3] CRAN (R 4.0.1)                       
##  fansi                  0.5.0      2021-05-25 [2] CRAN (R 4.0.5)                       
##  farver                 2.1.0      2021-02-28 [3] CRAN (R 4.0.5)                       
##  fastmap                1.1.0      2021-01-25 [3] CRAN (R 4.0.5)                       
##  FNN                    1.1.3      2019-02-15 [2] CRAN (R 4.0.5)                       
##  generics               0.1.0      2020-10-31 [3] CRAN (R 4.0.5)                       
##  GenomeInfoDb         * 1.26.4     2021-03-10 [1] Bioconductor                         
##  GenomeInfoDbData       1.2.4      2021-04-05 [1] Bioconductor                         
##  GenomicAlignments      1.26.0     2020-10-27 [1] Bioconductor                         
##  GenomicFeatures      * 1.42.3     2021-04-01 [1] Bioconductor                         
##  GenomicRanges        * 1.42.0     2020-10-27 [1] Bioconductor                         
##  ggbeeswarm             0.6.0      2017-08-07 [2] CRAN (R 4.0.5)                       
##  ggplot2              * 3.3.3      2020-12-30 [1] CRAN (R 4.0.5)                       
##  glue                   1.4.2      2020-08-27 [3] CRAN (R 4.0.5)                       
##  gridExtra              2.3        2017-09-09 [3] CRAN (R 4.0.1)                       
##  gtable                 0.3.0      2019-03-25 [3] CRAN (R 4.0.1)                       
##  HDF5Array              1.18.1     2021-02-04 [2] Bioconductor                         
##  highr                  0.9        2021-04-16 [3] CRAN (R 4.0.5)                       
##  hms                    1.1.0      2021-05-17 [3] CRAN (R 4.0.5)                       
##  htmltools              0.5.1.1    2021-01-22 [3] CRAN (R 4.0.5)                       
##  httr                   1.4.2      2020-07-20 [3] CRAN (R 4.0.5)                       
##  igraph                 1.2.6      2020-10-06 [2] CRAN (R 4.0.5)                       
##  IRanges              * 2.24.1     2020-12-12 [1] Bioconductor                         
##  irlba                  2.3.3      2019-02-05 [1] CRAN (R 4.0.5)                       
##  jquerylib              0.1.4      2021-04-26 [3] CRAN (R 4.0.5)                       
##  jsonlite               1.7.2      2020-12-09 [3] CRAN (R 4.0.5)                       
##  kableExtra           * 1.3.4.9000 2021-06-15 [2] Github (haozhu233/kableExtra@4c93f1a)
##  knitr                  1.33       2021-04-24 [2] CRAN (R 4.0.5)                       
##  labeling               0.4.2      2020-10-20 [3] CRAN (R 4.0.5)                       
##  lattice                0.20-44    2021-05-02 [4] CRAN (R 4.0.5)                       
##  lazyeval               0.2.2      2019-03-15 [2] CRAN (R 4.0.5)                       
##  lifecycle              1.0.0      2021-02-15 [3] CRAN (R 4.0.5)                       
##  limma                  3.46.0     2020-10-27 [1] Bioconductor                         
##  locfit                 1.5-9.4    2020-03-25 [1] CRAN (R 4.0.5)                       
##  magrittr               2.0.1      2020-11-17 [3] CRAN (R 4.0.5)                       
##  Matrix               * 1.3-4      2021-06-01 [4] CRAN (R 4.0.5)                       
##  MatrixGenerics       * 1.2.1      2021-01-30 [1] Bioconductor                         
##  matrixStats          * 0.58.0     2021-01-29 [1] CRAN (R 4.0.5)                       
##  memoise                2.0.0      2021-01-26 [1] CRAN (R 4.0.5)                       
##  munsell                0.5.0      2018-06-12 [3] CRAN (R 4.0.1)                       
##  openssl                1.4.4      2021-04-30 [3] CRAN (R 4.0.5)                       
##  pheatmap             * 1.0.12     2019-01-04 [1] CRAN (R 4.0.5)                       
##  pillar                 1.6.2      2021-07-29 [3] CRAN (R 4.0.5)                       
##  pkgconfig              2.0.3      2019-09-22 [3] CRAN (R 4.0.1)                       
##  prettyunits            1.1.1      2020-01-24 [3] CRAN (R 4.0.1)                       
##  progress               1.2.2      2019-05-16 [3] CRAN (R 4.0.1)                       
##  ProtGenerics           1.22.0     2020-10-27 [2] Bioconductor                         
##  purrr                  0.3.4      2020-04-17 [3] CRAN (R 4.0.1)                       
##  R.methodsS3            1.8.1      2020-08-26 [1] CRAN (R 4.0.5)                       
##  R.oo                   1.24.0     2020-08-26 [1] CRAN (R 4.0.5)                       
##  R.utils                2.10.1     2020-08-26 [1] CRAN (R 4.0.5)                       
##  R6                     2.5.0      2020-10-28 [3] CRAN (R 4.0.5)                       
##  rappdirs               0.3.3      2021-01-31 [1] CRAN (R 4.0.5)                       
##  RColorBrewer           1.1-2      2014-12-07 [1] CRAN (R 4.0.5)                       
##  Rcpp                   1.0.7      2021-07-07 [3] CRAN (R 4.0.5)                       
##  RCurl                  1.98-1.3   2021-03-16 [1] CRAN (R 4.0.5)                       
##  rhdf5                  2.34.0     2020-10-27 [2] Bioconductor                         
##  rhdf5filters           1.2.1      2021-05-03 [2] Bioconductor                         
##  Rhdf5lib               1.12.1     2021-01-26 [2] Bioconductor                         
##  rlang                  0.4.10     2020-12-30 [1] CRAN (R 4.0.5)                       
##  rmarkdown              2.10       2021-08-06 [2] CRAN (R 4.0.5)                       
##  Rsamtools              2.6.0      2020-10-27 [1] Bioconductor                         
##  RSpectra               0.16-0     2019-12-01 [2] CRAN (R 4.0.5)                       
##  RSQLite                2.2.5      2021-03-27 [1] CRAN (R 4.0.5)                       
##  rstudioapi             0.13       2020-11-12 [3] CRAN (R 4.0.5)                       
##  rsvd                   1.0.5      2021-04-16 [2] CRAN (R 4.0.5)                       
##  rtracklayer            1.50.0     2020-10-27 [1] Bioconductor                         
##  Rtsne                  0.15       2018-11-10 [2] CRAN (R 4.0.5)                       
##  rvest                  1.0.1      2021-07-26 [3] CRAN (R 4.0.5)                       
##  S4Vectors            * 0.28.1     2020-12-09 [1] Bioconductor                         
##  sass                   0.4.0      2021-05-12 [3] CRAN (R 4.0.5)                       
##  scales                 1.1.1      2020-05-11 [3] CRAN (R 4.0.1)                       
##  scater               * 1.18.6     2021-02-26 [2] Bioconductor                         
##  scran                * 1.18.7     2021-04-16 [2] Bioconductor                         
##  scuttle                1.0.4      2020-12-17 [2] Bioconductor                         
##  sessioninfo            1.1.1      2018-11-05 [2] CRAN (R 4.0.5)                       
##  SingleCellExperiment * 1.12.0     2020-10-27 [2] Bioconductor                         
##  sparseMatrixStats      1.2.1      2021-02-02 [2] Bioconductor                         
##  statmod                1.4.35     2020-10-19 [1] CRAN (R 4.0.5)                       
##  stringi                1.7.3      2021-07-16 [3] CRAN (R 4.0.5)                       
##  stringr                1.4.0      2019-02-10 [3] CRAN (R 4.0.1)                       
##  SummarizedExperiment * 1.20.0     2020-10-27 [1] Bioconductor                         
##  svglite                2.0.0      2021-02-20 [2] CRAN (R 4.0.5)                       
##  systemfonts            1.0.2      2021-05-11 [2] CRAN (R 4.0.5)                       
##  tibble                 3.1.3      2021-07-23 [3] CRAN (R 4.0.5)                       
##  tidyselect             1.1.1      2021-04-30 [3] CRAN (R 4.0.5)                       
##  utf8                   1.2.2      2021-07-24 [3] CRAN (R 4.0.5)                       
##  uwot                   0.1.10     2020-12-15 [2] CRAN (R 4.0.5)                       
##  vctrs                  0.3.8      2021-04-29 [3] CRAN (R 4.0.5)                       
##  vipor                  0.4.5      2017-03-22 [2] CRAN (R 4.0.5)                       
##  viridis                0.5.1      2018-03-29 [1] CRAN (R 4.0.5)                       
##  viridisLite            0.4.0      2021-04-13 [3] CRAN (R 4.0.5)                       
##  webshot                0.5.2      2019-11-22 [2] CRAN (R 4.0.5)                       
##  whisker                0.4        2019-08-28 [3] CRAN (R 4.0.1)                       
##  withr                  2.4.2      2021-04-18 [3] CRAN (R 4.0.5)                       
##  xaringan               0.22       2021-06-23 [1] CRAN (R 4.0.5)                       
##  xaringanthemer       * 0.4.0      2021-06-24 [2] CRAN (R 4.0.5)                       
##  xfun                   0.25       2021-08-06 [3] CRAN (R 4.0.5)                       
##  XML                    3.99-0.6   2021-03-16 [1] CRAN (R 4.0.5)                       
##  xml2                   1.3.2      2020-04-23 [3] CRAN (R 4.0.1)                       
##  XVector                0.30.0     2020-10-27 [1] Bioconductor                         
##  yaml                   2.2.1      2020-02-01 [3] CRAN (R 4.0.1)                       
##  zlibbioc               1.36.0     2020-10-27 [1] Bioconductor                         
## 
## [1] /home/yalbi/R/x86_64-pc-linux-gnu-library/4.0
## [2] /usr/local/lib/R/site-library
## [3] /usr/lib/R/site-library
## [4] /usr/lib/R/library
```

]]







    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
